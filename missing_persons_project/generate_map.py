import pandas as pd
import folium
from folium.plugins import HeatMap
import requests

# ---------- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–æ–≤ —Ä–µ–≥–∏–æ–Ω–æ–≤ ----------
REGION_COORDINATES = {
    '–ê–¥—ã–≥–µ—è': [44.6098, 40.1004],
    '–ê–ª—Ç–∞–π—Å–∫–∏–π': [52.5186, 85.2040],
    '–ê–º—É—Ä—Å–∫–∞—è': [50.2907, 127.5272],
    '–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∞—è': [64.5393, 40.5186],
    '–ê—Å—Ç—Ä–∞—Ö–∞–Ω—Å–∫–∞—è': [46.3479, 48.0336],
    '–ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω': [54.7355, 55.9587],
    '–ë–µ–ª–≥–æ—Ä–æ–¥—Å–∫–∞—è': [50.5978, 36.5858],
    '–ë—Ä—è–Ω—Å–∫–∞—è': [53.2434, 34.3642],
    '–ë—É—Ä—è—Ç–∏—è': [52.7182, 109.1770],
    '–í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è': [56.1290, 40.4066],
    '–í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è': [48.7080, 44.5133],
    '–í–æ–ª–æ–≥–æ–¥—Å–∫–∞—è': [59.2181, 39.8890],
    '–í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è': [51.6615, 39.2003],
    '–î–∞–≥–µ—Å—Ç–∞–Ω': [42.9849, 47.5047],
    '–ï–≤—Ä–µ–π—Å–∫–∞—è': [48.7947, 132.9218],
    '–ó–∞–±–∞–π–∫–∞–ª—å—Å–∫–∏–π': [52.0333, 113.5000],
    '–ò–≤–∞–Ω–æ–≤—Å–∫–∞—è': [57.0003, 40.9739],
    '–ò–Ω–≥—É—à–µ—Ç–∏—è': [43.1151, 45.0000],
    '–ò—Ä–∫—É—Ç—Å–∫–∞—è': [52.2864, 104.2807],
    '–ö–∞–±–∞—Ä–¥–∏–Ω–æ-–ë–∞–ª–∫–∞—Ä–∏—è': [43.4853, 43.6071],
    '–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è': [54.7104, 20.4522],
    '–ö–∞–ª–º—ã–∫–∏—è': [46.2313, 45.3272],
    '–ö–∞–ª—É–∂—Å–∫–∞—è': [54.5138, 36.2612],
    '–ö–∞–º—á–∞—Ç—Å–∫–∏–π': [53.0190, 158.5236],
    '–ö–∞—Ä–µ–ª–∏—è': [61.7850, 34.3469],
    '–ö–µ–º–µ—Ä–æ–≤—Å–∫–∞—è': [55.3547, 86.0873],
    '–ö–∏—Ä–æ–≤—Å–∫–∞—è': [58.6036, 49.6680],
    '–ö–æ–º–∏': [61.6688, 50.8354],
    '–ö–æ—Å—Ç—Ä–æ–º—Å–∫–∞—è': [57.7677, 40.9264],
    '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π': [45.0355, 38.9753],
    '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π': [56.0153, 92.8932],
    '–ö—Ä—ã–º': [44.9521, 34.1024],
    '–ö—É—Ä–≥–∞–Ω—Å–∫–∞—è': [55.4410, 65.3411],
    '–ö—É—Ä—Å–∫–∞—è': [51.7304, 36.1926],
    '–ö–ß–† ( –ö–∞—Ä–∞—á–∞–µ–≤–æ-–ß–µ—Ä–∫–µ—Å–∏—è )': [43.9133, 41.9260],
    '–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è': [59.9391, 30.3159],
    '–õ–∏–ø–µ—Ü–∫–∞—è': [52.6088, 39.5992],
    '–ú–∞–≥–∞–¥–∞–Ω—Å–∫–∞—è': [59.5603, 150.7985],
    '–ú–∞—Ä–∏–π –≠–ª': [56.6344, 47.8999],
    '–ú–æ—Ä–¥–æ–≤–∏—è': [54.1808, 45.1861],
    '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è': [55.7558, 37.6173],
    '–ú—É—Ä–º–∞–Ω—Å–∫–∞—è': [68.9585, 33.0827],
    '–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è': [56.3269, 44.0065],
    '–ù–æ–≤–≥–æ—Ä–æ–¥—Å–∫–∞—è': [58.5228, 31.2699],
    '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è': [55.0084, 82.9357],
    '–û–º—Å–∫–∞—è': [54.9893, 73.3682],
    '–û—Ä–µ–Ω–±—É—Ä–≥—Å–∫–∞—è': [51.7872, 55.1018],
    '–û—Ä–ª–æ–≤—Å–∫–∞—è': [52.9671, 36.0697],
    '–ü–µ–Ω–∑–µ–Ω—Å–∫–∞—è': [53.2007, 45.0046],
    '–ü–µ—Ä–º—Å–∫–∏–π': [58.0105, 56.2294],
    '–ü—Ä–∏–º–æ—Ä—Å–∫–∏–π': [43.1155, 131.8855],
    '–ü—Å–∫–æ–≤—Å–∫–∞—è': [57.8194, 28.3318],
    '–†–µ—Å–ø. –ê–ª—Ç–∞–π': [50.7114, 86.9353],
    '–†–æ—Å—Ç–æ–≤—Å–∫–∞—è': [47.2224, 39.7189],
    '–†–°–û ( –°–µ–≤–µ—Ä–Ω–∞—è –û—Å–µ—Ç–∏—è )': [43.0241, 44.6813],
    '–†—è–∑–∞–Ω—Å–∫–∞—è': [54.6294, 39.7420],
    '–°–∞–º–∞—Ä—Å–∫–∞—è': [53.1951, 50.1069],
    '–°–∞—Ä–∞—Ç–æ–≤—Å–∫–∞—è': [51.5336, 46.0343],
    '–°–∞—Ö–∞ (–Ø–∫—É—Ç–∏—è)': [62.0278, 129.7315],
    '–°–∞—Ö–∞–ª–∏–Ω—Å–∫–∞—è': [46.9591, 142.7380],
    '–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è': [56.8389, 60.6057],
    '–°–º–æ–ª–µ–Ω—Å–∫–∞—è': [54.7826, 32.0453],
    '–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–∏–π': [45.0433, 41.9691],
    '–¢–∞–º–±–æ–≤—Å–∫–∞—è': [52.7212, 41.4523],
    '–¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω': [55.7944, 49.1114],
    '–¢–≤–µ—Ä—Å–∫–∞—è': [56.8587, 35.9176],
    '–¢–æ–º—Å–∫–∞—è': [56.4846, 84.9482],
    '–¢—É–ª—å—Å–∫–∞—è': [54.1931, 37.6173],
    '–¢—ã–≤–∞': [51.7191, 94.4380],
    '–¢—é–º–µ–Ω—Å–∫–∞—è': [57.1530, 65.5343],
    '–£–¥–º—É—Ä—Ç—Å–∫–∞—è': [56.8527, 53.2115],
    '–£–ª—å—è–Ω–æ–≤—Å–∫–∞—è': [54.3142, 48.4031],
    '–•–∞–±–∞—Ä–æ–≤—Å–∫–∏–π': [48.4802, 135.0719],
    '–•–∞–∫–∞—Å–∏—è': [53.7223, 91.4435],
    '–•–ú–ê–û': [61.0032, 69.0189],
    '–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è': [55.1644, 61.4368],
    '–ß–µ—á–µ–Ω—Å–∫–∞—è': [43.3180, 45.6883],
    '–ß—É–≤–∞—à–∏—è': [56.1439, 47.2489],
    '–ß—É–∫–æ—Ç—Å–∫–∏–π': [66.0000, 169.0000],
    '–Ø–ù–ê–û': [66.5299, 66.6145],
    '–Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è': [57.6261, 39.8845]
}

# ---------- –ú–∞–ø–ø–∏–Ω–≥ GeoJSON ‚Üí CSV ----------
REGION_NAME_MAPPING = {
    '–ê–¥—ã–≥–µ—è': '–ê–¥—ã–≥–µ—è',
    '–ê–ª—Ç–∞–π—Å–∫–∏–π –∫—Ä–∞–π': '–ê–ª—Ç–∞–π—Å–∫–∏–π',
    '–ê–ª—Ç–∞–π': '–†–µ—Å–ø. –ê–ª—Ç–∞–π',
    '–ê–º—É—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ê–º—É—Ä—Å–∫–∞—è',
    '–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∞—è',
    '–ê—Å—Ç—Ä–∞—Ö–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ê—Å—Ç—Ä–∞—Ö–∞–Ω—Å–∫–∞—è',
    '–ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω': '–ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω',
    '–ë–µ–ª–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ë–µ–ª–≥–æ—Ä–æ–¥—Å–∫–∞—è',
    '–ë—Ä—è–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ë—Ä—è–Ω—Å–∫–∞—è',
    '–ë—É—Ä—è—Ç–∏—è': '–ë—É—Ä—è—Ç–∏—è',
    '–í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è',
    '–í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è',
    '–í–æ–ª–æ–≥–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–í–æ–ª–æ–≥–æ–¥—Å–∫–∞—è',
    '–í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è',
    '–î–∞–≥–µ—Å—Ç–∞–Ω': '–î–∞–≥–µ—Å—Ç–∞–Ω',
    '–ï–≤—Ä–µ–π—Å–∫–∞—è –∞–≤—Ç–æ–Ω–æ–º–Ω–∞—è –æ–±–ª–∞—Å—Ç—å': '–ï–≤—Ä–µ–π—Å–∫–∞—è',
    '–ó–∞–±–∞–π–∫–∞–ª—å—Å–∫–∏–π –∫—Ä–∞–π': '–ó–∞–±–∞–π–∫–∞–ª—å—Å–∫–∏–π',
    '–ò–≤–∞–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ò–≤–∞–Ω–æ–≤—Å–∫–∞—è',
    '–ò–Ω–≥—É—à–µ—Ç–∏—è': '–ò–Ω–≥—É—à–µ—Ç–∏—è',
    '–ò—Ä–∫—É—Ç—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ò—Ä–∫—É—Ç—Å–∫–∞—è',
    '–ö–∞–±–∞—Ä–¥–∏–Ω–æ-–ë–∞–ª–∫–∞—Ä—Å–∫–∞—è —Ä–µ—Å–ø—É–±–ª–∏–∫–∞': '–ö–∞–±–∞—Ä–¥–∏–Ω–æ-–ë–∞–ª–∫–∞—Ä–∏—è',
    '–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è',
    '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö–∞–ª–º—ã–∫–∏—è': '–ö–∞–ª–º—ã–∫–∏—è',
    '–ö–∞–ª—É–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ö–∞–ª—É–∂—Å–∫–∞—è',
    '–ö–∞–º—á–∞—Ç—Å–∫–∏–π –∫—Ä–∞–π': '–ö–∞–º—á–∞—Ç—Å–∫–∏–π',
    '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö–∞—Ä–µ–ª–∏—è': '–ö–∞—Ä–µ–ª–∏—è',
    '–ö–µ–º–µ—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ö–µ–º–µ—Ä–æ–≤—Å–∫–∞—è',
    '–ö–∏—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ö–∏—Ä–æ–≤—Å–∫–∞—è',
    '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö–æ–º–∏': '–ö–æ–º–∏',
    '–ö–æ—Å—Ç—Ä–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ö–æ—Å—Ç—Ä–æ–º—Å–∫–∞—è',
    '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π': '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π',
    '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π': '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π',
    '–ö—Ä—ã–º': '–ö—Ä—ã–º',
    '–ö—É—Ä–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ö—É—Ä–≥–∞–Ω—Å–∫–∞—è',
    '–ö—É—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ö—É—Ä—Å–∫–∞—è',
    '–ö–∞—Ä–∞—á–∞–µ–≤–æ-–ß–µ—Ä–∫–µ—Å—Å–∫–∞—è —Ä–µ—Å–ø—É–±–ª–∏–∫–∞': '–ö–ß–† ( –ö–∞—Ä–∞—á–∞–µ–≤–æ-–ß–µ—Ä–∫–µ—Å–∏—è )',
    '–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è',
    '–õ–∏–ø–µ—Ü–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–õ–∏–ø–µ—Ü–∫–∞—è',
    '–ú–∞–≥–∞–¥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ú–∞–≥–∞–¥–∞–Ω—Å–∫–∞—è',
    '–ú–∞—Ä–∏–π –≠–ª': '–ú–∞—Ä–∏–π –≠–ª',
    '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ú–æ—Ä–¥–æ–≤–∏—è': '–ú–æ—Ä–¥–æ–≤–∏—è',
    '–ú–æ—Å–∫–≤–∞': '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è',
    '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è',
    '–ú—É—Ä–º–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ú—É—Ä–º–∞–Ω—Å–∫–∞—è',
    '–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è',
    '–ù–æ–≤–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ù–æ–≤–≥–æ—Ä–æ–¥—Å–∫–∞—è',
    '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è',
    '–û–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–û–º—Å–∫–∞—è',
    '–û—Ä–µ–Ω–±—É—Ä–≥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–û—Ä–µ–Ω–±—É—Ä–≥—Å–∫–∞—è',
    '–û—Ä–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–û—Ä–ª–æ–≤—Å–∫–∞—è',
    '–ü–µ–Ω–∑–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ü–µ–Ω–∑–µ–Ω—Å–∫–∞—è',
    '–ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π': '–ü–µ—Ä–º—Å–∫–∏–π',
    '–ü—Ä–∏–º–æ—Ä—Å–∫–∏–π –∫—Ä–∞–π': '–ü—Ä–∏–º–æ—Ä—Å–∫–∏–π',
    '–ü—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ü—Å–∫–æ–≤—Å–∫–∞—è',
    '–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–†–æ—Å—Ç–æ–≤—Å–∫–∞—è',
    '–°–µ–≤–µ—Ä–Ω–∞—è –û—Å–µ—Ç–∏—è - –ê–ª–∞–Ω–∏—è': '–†–°–û ( –°–µ–≤–µ—Ä–Ω–∞—è –û—Å–µ—Ç–∏—è )',
    '–†—è–∑–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–†—è–∑–∞–Ω—Å–∫–∞—è',
    '–°–∞–º–∞—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–°–∞–º–∞—Ä—Å–∫–∞—è',
    '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥': '–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è',
    '–°–∞—Ä–∞—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–°–∞—Ä–∞—Ç–æ–≤—Å–∫–∞—è',
    '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –°–∞—Ö–∞ (–Ø–∫—É—Ç–∏—è)': '–°–∞—Ö–∞ (–Ø–∫—É—Ç–∏—è)',
    '–°–∞—Ö–∞–ª–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–°–∞—Ö–∞–ª–∏–Ω—Å–∫–∞—è',
    '–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è',
    '–°–º–æ–ª–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–°–º–æ–ª–µ–Ω—Å–∫–∞—è',
    '–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–∏–π –∫—Ä–∞–π': '–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–∏–π',
    '–¢–∞–º–±–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–¢–∞–º–±–æ–≤—Å–∫–∞—è',
    '–¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω': '–¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω',
    '–¢–≤–µ—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–¢–≤–µ—Ä—Å–∫–∞—è',
    '–¢–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–¢–æ–º—Å–∫–∞—è',
    '–¢—É–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–¢—É–ª—å—Å–∫–∞—è',
    '–¢—ã–≤–∞': '–¢—ã–≤–∞',
    '–¢—é–º–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–¢—é–º–µ–Ω—Å–∫–∞—è',
    '–£–¥–º—É—Ä—Ç—Å–∫–∞—è —Ä–µ—Å–ø—É–±–ª–∏–∫–∞': '–£–¥–º—É—Ä—Ç—Å–∫–∞—è',
    '–£–ª—å—è–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–£–ª—å—è–Ω–æ–≤—Å–∫–∞—è',
    '–•–∞–±–∞—Ä–æ–≤—Å–∫–∏–π –∫—Ä–∞–π': '–•–∞–±–∞—Ä–æ–≤—Å–∫–∏–π',
    '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –•–∞–∫–∞—Å–∏—è': '–•–∞–∫–∞—Å–∏—è',
    '–•–∞–Ω—Ç—ã-–ú–∞–Ω—Å–∏–π—Å–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥ - –Æ–≥—Ä–∞': '–•–ú–ê–û',
    '–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è',
    '–ß–µ—á–µ–Ω—Å–∫–∞—è —Ä–µ—Å–ø—É–±–ª–∏–∫–∞': '–ß–µ—á–µ–Ω—Å–∫–∞—è',
    '–ß—É–≤–∞—à–∏—è': '–ß—É–≤–∞—à–∏—è',
    '–ß—É–∫–æ—Ç—Å–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥': '–ß—É–∫–æ—Ç—Å–∫–∏–π',
    '–Ø–º–∞–ª–æ-–ù–µ–Ω–µ—Ü–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥': '–Ø–ù–ê–û',
    '–Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è',
    '–ù–µ–Ω–µ—Ü–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥': '–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∞—è'
}

# ---------- –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ ----------
COLOR_PALETTE = {
    
    'very_high': '#B22222',   # Firebrick
    'high': '#DC143C',  # Crimson
    'medium_high':'#FF4500',  # Orange Red
    'medium':'#FF8C00',  # Dark Orange
    'medium_low': '#FFA500',  # Orange
    'low': '#FFD700',  # Gold
    'very_low': '#FFFF00',  # Bright Yellow
    'border': '#DDC1F3',
    'marker': '#7B1FA2'
}

def get_color_for_value(value, df):
    """
    Get color for value based on quantiles from dataframe
    """
    # Calculate quantiles from the '–ö–æ–ª–≤–æ –Ω–∞ 100–∫' column
    q95 = df['–ö–æ–ª–≤–æ –Ω–∞ 100–∫'].quantile(0.95)  # 95th percentile
    q85 = df['–ö–æ–ª–≤–æ –Ω–∞ 100–∫'].quantile(0.85)  # 85th percentile
    q70 = df['–ö–æ–ª–≤–æ –Ω–∞ 100–∫'].quantile(0.70)  # 70th percentile
    q50 = df['–ö–æ–ª–≤–æ –Ω–∞ 100–∫'].quantile(0.50)  # 50th percentile (median)
    q30 = df['–ö–æ–ª–≤–æ –Ω–∞ 100–∫'].quantile(0.30)  # 30th percentile
    q15 = df['–ö–æ–ª–≤–æ –Ω–∞ 100–∫'].quantile(0.15)  # 15th percentile
    
    if value >= q95:
        return COLOR_PALETTE['very_high']
    elif value >= q85:
        return COLOR_PALETTE['high']
    elif value >= q70:
        return COLOR_PALETTE['medium_high']
    elif value >= q50:
        return COLOR_PALETTE['medium']
    elif value >= q30:
        return COLOR_PALETTE['medium_low']
    elif value >= q15:
        return COLOR_PALETTE['low']
    else:
        return COLOR_PALETTE['very_low']

# ---------- –°–æ–∑–¥–∞–Ω–∏–µ popup –¥–ª—è —Ä–µ–≥–∏–æ–Ω–∞ ----------
def create_popup_for_region(geojson_region_name):
    csv_region_name = REGION_NAME_MAPPING.get(geojson_region_name, geojson_region_name)
    region_row = df[df['–†–µ–≥–∏–æ–Ω'] == csv_region_name]
    if region_row.empty:
        return folium.Popup("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö", max_width=250)

    row = region_row.iloc[0]
    popup_html = f"""
    <div style="font-family: 'Segoe UI', Arial, sans-serif; width: 300px;">
        <div style="background: linear-gradient(135deg, {COLOR_PALETTE['marker']}, #9C27B0); 
             padding: 18px; color: white; border-radius: 10px 10px 0 0;">
            <h3 style="margin: 0; font-size: 20px;">{row['–†–µ–≥–∏–æ–Ω']}</h3>
        </div>
        <div style="padding: 18px; background: white; border-radius: 0 0 10px 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 18px;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                     padding: 12px; border-radius: 8px; text-align: center;">
                    <div style="font-weight: bold; color: white; font-size: 20px;">{row['–ö–æ–ª-–≤–æ –∑–∞—è–≤–æ–∫']:,}</div>
                    <div style="font-size: 11px; color: rgba(255,255,255,0.9);">–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</div>
                </div>
                <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); 
                     padding: 12px; border-radius: 8px; text-align: center;">
                    <div style="font-weight: bold; color: white; font-size: 20px;">{row['–ö–æ–ª–≤–æ –Ω–∞ 100–∫']:.2f}</div>
                    <div style="font-size: 11px; color: rgba(255,255,255,0.9);">–ù–∞ 100–∫</div>
                </div>
            </div>
            <div style="margin-bottom: 12px; padding: 10px; background: #f0f8ff; border-radius: 6px;">
                <div style="font-size: 12px; color: #666;">–ù–∞—Å–µ–ª–µ–Ω–∏–µ:</div>
                <div style="font-size: 16px; font-weight: bold;">{int(row['–ù–∞—Å–µ–ª–µ–Ω–∏–µ']):,}</div>
            </div>
            <div style="border-top: 2px solid #f0f0f0; padding-top: 12px;">
                <div style="display: flex; justify-content: space-between;"><span>–ê–∫—Ç–∏–≤–Ω—ã–µ:</span><strong>{row['–ê–∫—Ç–∏–≤']}</strong></div>
                <div style="display: flex; justify-content: space-between;"><span>–ò–Ω—Ñ–æ–ø–æ–∏—Å–∫:</span><strong>{row['–ò–Ω—Ñ–æ–ø–æ–∏—Å–∫']}</strong></div>
                <div style="display: flex; justify-content: space-between;"><span>–ê–≤—Ç–æ–Ω–æ–º:</span><strong>{row['–ê–≤—Ç–æ–Ω–æ–º']}</strong></div>
                <div style="display: flex; justify-content: space-between;"><span>–õ–ù–°:</span><strong>{row['–õ–ù–°']}</strong></div>
                <div style="display: flex; justify-content: space-between;"><span>–ü–æ–≥–∏–±–ª–æ:</span><strong style="color:red">{row['–ü–æ–≥–∏–±']}</strong></div>
                <div style="display: flex; justify-content: space-between;"><span>–£—Ç–æ–Ω—É–ª–æ:</span><strong style="color:blue">{row['–£—Ç–æ–Ω—É–ª']}</strong></div>
            </div>
        </div>
    </div>
    """
    return folium.Popup(popup_html, max_width=320)

# ---------- 2GIS Tile Layers ----------
def create_2gis_tile_layers():
    """Create 2GIS tile layers that mimic OpenStreetMap style"""
    
    # 2GIS Vector Light (similar to CartoDB positron)
    tiles_2gis_light = folium.TileLayer(
        tiles='https://tile2.maps.2gis.com/tiles?x={x}&y={y}&z={z}',
        attr='2GIS',
        name='2GIS Light',
        control=True,
        opacity=1.0
    )
    
    # 2GIS Basic (similar to standard OSM)
    tiles_2gis_basic = folium.TileLayer(
        tiles='https://tile1.maps.2gis.com/tiles?x={x}&y={y}&z={z}',
        attr='2GIS',
        name='2GIS Basic',
        control=True,
        opacity=1.0
    )
    
    return tiles_2gis_light, tiles_2gis_basic

# ---------- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–∞—Ä—Ç—ã ----------
def create_stylish_map(df):
    max_value = df['–ö–æ–ª–≤–æ –Ω–∞ 100–∫'].max()
    min_value = df['–ö–æ–ª–≤–æ –Ω–∞ 100–∫'].min()
    mean_value = df['–ö–æ–ª–≤–æ –Ω–∞ 100–∫'].mean()

    print(f"üìä –î–∏–∞–ø–∞–∑–æ–Ω –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ 100–∫ –Ω–∞—Å–µ–ª–µ–Ω–∏—è:")
    print(f"   –ú–∏–Ω–∏–º—É–º: {min_value:.2f}")
    print(f"   –ú–∞–∫—Å–∏–º—É–º: {max_value:.2f}")
    print(f"   –°—Ä–µ–¥–Ω–µ–µ: {mean_value:.2f}")

    # –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É —Å 2GIS –≤ –∫–∞—á–µ—Å—Ç–≤–µ –±–∞–∑–æ–≤–æ–≥–æ —Å–ª–æ—è
    m = folium.Map(location=[61.5, 95], zoom_start=3, tiles=None, control_scale=True)
    
    # –î–æ–±–∞–≤–ª—è–µ–º 2GIS —Å–ª–æ–∏
    tiles_2gis_light, tiles_2gis_basic = create_2gis_tile_layers()
    tiles_2gis_light.add_to(m)
    tiles_2gis_basic.add_to(m)

    # –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞
    heat_data = [[row['latitude'], row['longitude'], row['–ö–æ–ª–≤–æ –Ω–∞ 100–∫']] for _, row in df.iterrows()]
    heatmap_layer = folium.FeatureGroup(name='–¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞', show=False)
    HeatMap(heat_data, min_opacity=0.4, max_opacity=0.95, radius=45, blur=30, max_zoom=13,
            gradient={0.0: '#00CED1', 0.2: '#00FF00', 0.4: '#FFFF00', 0.6: '#FFA500', 0.8: '#FF4500', 1.0: '#8B0000'}).add_to(heatmap_layer)
    heatmap_layer.add_to(m)

    # GeoJSON —Å–ª–æ–π —Ä–µ–≥–∏–æ–Ω–æ–≤
    regions_layer = folium.FeatureGroup(name='–†–µ–≥–∏–æ–Ω—ã —Å –¥–∞–Ω–Ω—ã–º–∏', show=True)
    geojson_url = "https://raw.githubusercontent.com/codeforamerica/click_that_hood/master/public/data/russia.geojson"
    geojson_data = requests.get(geojson_url).json()

    # ---------- –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–≥–∏–æ–Ω—ã –ø–æ –æ–¥–Ω–æ–º—É —Å popup ----------
    for feature in geojson_data['features']:
        geo_name = feature['properties']['name']
        csv_name = REGION_NAME_MAPPING.get(geo_name, geo_name)
        row = df[df['–†–µ–≥–∏–æ–Ω'] == csv_name]
        if row.empty:
            continue

        region_popup = create_popup_for_region(geo_name)
        color = get_color_for_value(row['–ö–æ–ª–≤–æ –Ω–∞ 100–∫'].iloc[0], df)

        folium.GeoJson(
            feature,
            style_function=lambda f, color=color: {
                'fillColor': color,
                'color': COLOR_PALETTE['border'],
                'weight': 1.2,
                'fillOpacity': 0.8,
                'dashArray': '3, 3'
            },
            highlight_function=lambda f: {
                'fillColor': '#ffffff',
                'color': 'none',           # ‚Üê —É–±–∏—Ä–∞–µ–º –æ–±–≤–æ–¥–∫—É
                'weight': 0,               # ‚Üê —Ç–æ–ª—â–∏–Ω–∞ 0
                'fillOpacity': 0.4
            },
            popup=region_popup,
            tooltip=folium.GeoJsonTooltip(
                fields=['name'],
                aliases=['–†–µ–≥–∏–æ–Ω:'],
                style=("background-color: white; color: #333; font-family: Arial; "
                       "font-size: 12px; padding: 8px; border-radius: 4px;")
            )
        ).add_to(regions_layer)

    regions_layer.add_to(m)

    # –õ–µ–≥–µ–Ω–¥–∞
    legend_html = f'''
    <div style="position: fixed; bottom: 50px; left: 50px; width: 320px; background: white; border: none; z-index:9999;
         font-family: 'Segoe UI', Arial; font-size: 13px; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
         <h4 style="margin: 0 0 16px 0; color: #2C3E50; font-size: 16px; font-weight: 600;">
            üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–ø–∞–≤—à–∏—Ö (–Ω–∞ 100–∫ –Ω–∞—Å–µ–ª–µ–Ω–∏—è)
         </h4>
         <div style="display: grid; grid-template-columns: 25px 1fr; gap: 10px; align-items: center;">
            <div style="width: 20px; height: 20px; background: {COLOR_PALETTE['very_high']}; border-radius: 4px;"></div>
            <div>–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π (‚â•200)</div>
            <div style="width: 20px; height: 20px; background: {COLOR_PALETTE['high']}; border-radius: 4px;"></div>
            <div>–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π (150-200)</div>
            <div style="width: 20px; height: 20px; background: {COLOR_PALETTE['medium_high']}; border-radius: 4px;"></div>
            <div>–í—ã—Å–æ–∫–∏–π (100-150)</div>
            <div style="width: 20px; height: 20px; background: {COLOR_PALETTE['medium']}; border-radius: 4px;"></div>
            <div>–ü–æ–≤—ã—à–µ–Ω–Ω—ã–π (60-100)</div>
            <div style="width: 20px; height: 20px; background: {COLOR_PALETTE['medium_low']}; border-radius: 4px;"></div>
            <div>–°—Ä–µ–¥–Ω–∏–π (30-60)</div>
            <div style="width: 20px; height: 20px; background: {COLOR_PALETTE['low']}; border-radius: 4px;"></div>
            <div>–ù–∏–∑–∫–∏–π (15-30)</div>
            <div style="width: 20px; height: 20px; background: {COLOR_PALETTE['very_low']}; border-radius: 4px;"></div>
            <div>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (<15)</div>
         </div>
         <div style="margin-top: 16px; padding-top: 12px; border-top: 2px solid #f0f0f0;">
            <div>üìå –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–≥–∏–æ–Ω –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</div>
            <div>üî• –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å–ª–æ–µ–≤ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É</div>
         </div>
         <div style="margin-top: 12px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
            <small><strong>–î–∏–∞–ø–∞–∑–æ–Ω:</strong> {min_value:.2f} - {max_value:.2f}<br><strong>–°—Ä–µ–¥–Ω–µ–µ:</strong> {mean_value:.2f}</small>
         </div>
    </div>
    '''
    m.get_root().html.add_child(folium.Element(legend_html))

    folium.LayerControl(position='topright', collapsed=False).add_to(m)
    m.get_root().header.add_child(folium.Element('''
        <style>
            /* –£–±–∏—Ä–∞–µ—Ç —Ñ–æ–∫—É—Å-—Ä–∞–º–∫—É –≤–æ–∫—Ä—É–≥ –ø–æ–ª–∏–≥–æ–Ω–∞ */
            .leaflet-container path:focus {
                outline: none !important;
                box-shadow: none !important;
                stroke: none !important;
            }
        </style>
    '''))
    return m

# ---------- –ó–∞–ø—É—Å–∫ ----------
if __name__ == "__main__":
    df = pd.read_csv('russian_regions_81.csv')
    df['–ö–æ–ª–≤–æ –Ω–∞ 100–∫'] = (df['–ö–æ–ª-–≤–æ –∑–∞—è–≤–æ–∫'] / df['–ù–∞—Å–µ–ª–µ–Ω–∏–µ']) * 100000
    df['latitude'] = df['–†–µ–≥–∏–æ–Ω'].map(lambda x: REGION_COORDINATES.get(x, [55.7558, 37.6173])[0])
    df['longitude'] = df['–†–µ–≥–∏–æ–Ω'].map(lambda x: REGION_COORDINATES.get(x, [55.7558, 37.6173])[1])

    stylish_map = create_stylish_map(df)
    stylish_map.save('stylish_russia_map.html')
    print("‚úÖ –ö–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞: –æ—Ç–∫—Ä–æ–π—Ç–µ stylish_russia_map.html")